<!-- ABOUT THE PROJECT -->
## About The Project
This project was conceived as a POC for a number of 'Spring for Apache Kafka' samples of Producers and Consumers using 
different types of serializers and de-serializers.

The repository contains examples of Producers and Consumers using the following serializers (and their correspondent 
de-serializers):
* org.apache.kafka.common.serialization.StringSerializer
* org.springframework.kafka.support.serializer.JsonSerializer
* com.abmanzano.kafkasamplespring.serdes.AvroSerializer using Apache Avro
* com.abmanzano.kafkasamplespring.serdes.ProtobufSerializer using Google Protocol Buffers

In addition, we will provide information about the message size when published to Kafka via the mentioned serializers.

<!-- TECH -->
## Built with
* [Java 11](https://www.oracle.com/java/)
* [Spring Boot](https://spring.io/projects/spring-boot)
* [Kafka](https://kafka.apache.org/)
* [Spring for Apache Kafka](https://spring.io/projects/spring-kafka)
* [Apache Avro](https://avro.apache.org/docs/current/spec.html)
* [Google Protocol Buffers](https://developers.google.com/protocol-buffers/)
* [Maven](https://maven.apache.org/)
* [GIT](https://git-scm.com/)

<!-- GETTING STARTED -->
## Getting Started

You might find here some instructions on how to use the resources in this repository.

### Prerequisites
* JDK 11

For this project I used Zulu's build of OpenJDK, but you might use a different one.

* Maven

At the moment of writing this code I used apache-maven-3.8.4

### Installation
1. Clone the repo
   ```sh
   git clone https://github.com/abmanzano/kafka-sample-spring.git
   ```
2. Build the project with maven and ensure that all the dependencies are downloaded.

### Usage
Just run as a regular Spring Boot application.

Once the application is running, the **Consumers** will print the de-serialised messages to the console/terminal.

The Kafka **Producers** are available via REST. You might curl one of the available endpoints in order to publish a 
message to its correspondent topic.

### Avro
- The Avro [Producer](src/main/java/com/abmanzano/kafkasamplespring/producer/KafkaProducerAvro.java) and 
[Consumer](src/main/java/com/abmanzano/kafkasamplespring/consumer/KafkaConsumerAvro.java) implemented in this repository
publish and consume an Order POJO.  
Order POJO: *target/generated-sources/com/abmanzano/avro/model/Order.java*
- Order POJO is generated by **avro-maven-plugin** when building the project (*mvn clean compile*). 
- The plugin generates the POJO based on an [Avro schema](src/main/resources/avro/OrderAvroRecord.avsc).
- This Avro schema is generated manually using the SchemaBuilder utility.  
Code can be found on [KafkaSampleSpringApplicationTests](src/test/java/com/abmanzano/kafkasamplespring/KafkaSampleSpringApplicationTests.java). 
The test 'generateOrderAvroSchema()' gives us the JSON structure of the Avro Schema.

**Alternative solution:**

Sometimes the SchemaBuilder utility will not be an ideal solution, for example if the object to transfer is complex, 
many fields, inheritance, members on external classes, etc. In that case we can use **jackson-databind** lib to get the 
Avro Schema from the object's .class file. As a mere example of how this would work, I've included some of the code in
this repository without actually using it in any Producer or Consumer. Please find details below:

- Test 'generateOrderAvroSchemaFromPojo()' on
[KafkaSampleSpringApplicationTests](src/test/java/com/abmanzano/kafkasamplespring/KafkaSampleSpringApplicationTests.java)
returns an [Avro schema](src/main/resources/avro/OrderAvroRecordFromJacksonLib.avsc) based on the 
[Order](src/main/java/com/abmanzano/kafkasamplespring/dto/Order.java) .class
- Same as with the example above, an Order POJO is generated by **avro-maven-plugin** based on this Avro schema.  
Order POJO: *target/generated-sources/com/abmanzano/avrojacksonlib/dto/Order.java*
- This POJO have been used to create a dummy Order in 
[AvroJacksonLibUtils](src/main/java/com/abmanzano/kafkasamplespring/util/AvroJacksonLibUtils.java).

As previously stated, this dummy Order is not been published or consumed by any Producer/Consumer in this repository. 
But you can reuse the existing ones by just replacing the DTO on:
- [KafkaProducerAvro](src/main/java/com/abmanzano/kafkasamplespring/producer/KafkaProducerAvro.java)
- [KafkaConsumerAvro](src/main/java/com/abmanzano/kafkasamplespring/consumer/KafkaConsumerAvro.java)
- [AvroProducerConfig](src/main/java/com/abmanzano/kafkasamplespring/config/AvroProducerConfig.java)
- [AvroConsumerConfig](src/main/java/com/abmanzano/kafkasamplespring/config/AvroConsumerConfig.java)

### Protobuf
1. Download and install the protocol buffer compiler.
2. Generating Java Code From Protobuf File. e.g.
```sh
protoc -I=C:\Users\anmm\workspace\kafka-sample-spring\src\main\resources\protobuf 
--java_out=C:\Users\anmm\workspace\kafka-sample-spring\src\main\java\com\abmanzano\kafkasamplespring\dto\protobuf\ 
Brand.proto

protoc -I=C:\Users\anmm\workspace\kafka-sample-spring\src\main\resources\protobuf 
--java_out=C:\Users\anmm\workspace\kafka-sample-spring\src\main\java\com\abmanzano\kafkasamplespring\dto\protobuf\ 
Product.proto

protoc -I=C:\Users\anmm\workspace\kafka-sample-spring\src\main\resources\protobuf 
--java_out=C:\Users\anmm\workspace\kafka-sample-spring\src\main\java\com\abmanzano\kafkasamplespring\dto\protobuf\ 
Order.proto
```
There is also the option to use [protoc-jar-maven-plugin](https://mvnrepository.com/artifact/com.github.os72/protoc-jar-maven-plugin) 
to generate the java class from the .proto files.
```sh
<plugin>
   <groupId>com.github.os72</groupId>
   <artifactId>protoc-jar-maven-plugin</artifactId>
   <version>${deps.protobuf.version}</version>
   <executions>
      <execution>
         <phase>generate-sources</phase>
         <goals>
            <goal>run</goal>
         </goals>
         <configuration>
            <addProtoSources>all</addProtoSources>
            <inputDirectories>
               <directory>${basedir}/src/main/resources/protobuf</directory>
            </inputDirectories>
            <outputTargets>
               <outputTarget>
                  <type>java</type>
                  <outputDirectory>${basedir}/target/generated-sources/protobuf</outputDirectory>
               </outputTarget>
            </outputTargets>
         </configuration>
      </execution>
   </executions>
</plugin>
```

### Notes
Tests have been run using the different serialization methods to compare the resulting message size when attempted to
be published to Kafka.
Results can be seen on text file [Message_size](Message_size.txt)

<!-- ROADMAP -->
## Roadmap
- [x] Producer and Consumer with Kafka String Serializer
- [x] Producer and Consumer with Spring Json Serializer
- [x] Producer and Consumer with Apache Avro Serializer
- [x] Producer and Consumer with Google Protocol Buffers Serializer
- [x] Producer and Consumer with Custom SerDes
- [x] Transfer large object
- [x] Compare the size of the messages when published to Kafka via the different serializers